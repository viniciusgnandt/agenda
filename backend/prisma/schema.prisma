generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  PROFESSIONAL
}

enum AppointmentStatus {
  SCHEDULED
  CONFIRMED
  CANCELLED
  COMPLETED
}

// =======================
// EMPRESA (TENANT)
// =======================
model Company {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  phone     String?
  createdAt DateTime @default(now())

  users         User[]
  professionals Professional[]
  services      Service[]
  customers     Customer[]
  appointments  Appointment[]
}

// =======================
// USUÁRIOS DO SISTEMA
// =======================
model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String
  role      UserRole
  createdAt DateTime @default(now())

  company   Company @relation(fields: [companyId], references: [id])
  companyId String
}

// =======================
// CLIENTES
// =======================
model Customer {
  id        String   @id @default(uuid())
  name      String
  phone     String
  email     String?
  createdAt DateTime @default(now())

  company   Company @relation(fields: [companyId], references: [id])
  companyId String

  appointments Appointment[]
}

// =======================
// PROFISSIONAIS
// =======================
model Professional {
  id        String   @id @default(uuid())
  name      String
  createdAt DateTime @default(now())

  company   Company @relation(fields: [companyId], references: [id])
  companyId String

  services      ProfessionalService[]
  workingHours  WorkingHour[]
  appointments  Appointment[]
}

// =======================
// SERVIÇOS
// =======================
model Service {
  id        String   @id @default(uuid())
  name      String
  price     Decimal
  duration  Int // minutos
  createdAt DateTime @default(now())

  company   Company @relation(fields: [companyId], references: [id])
  companyId String

  professionals ProfessionalService[]
  appointments  Appointment[]
}

// =======================
// PROFISSIONAL x SERVIÇO (N:N)
// =======================
model ProfessionalService {
  professional   Professional @relation(fields: [professionalId], references: [id])
  professionalId String

  service   Service @relation(fields: [serviceId], references: [id])
  serviceId String

  @@id([professionalId, serviceId])
}

// =======================
// HORÁRIO DE TRABALHO
// =======================
model WorkingHour {
  id             String @id @default(uuid())
  dayOfWeek      Int    // 0=Domingo, 6=Sábado
  startTime      String // "09:00"
  endTime        String // "18:00"

  professional   Professional @relation(fields: [professionalId], references: [id])
  professionalId String
}

// =======================
// AGENDAMENTOS
// =======================
model Appointment {
  id        String   @id @default(uuid())
  date      DateTime
  status    AppointmentStatus @default(SCHEDULED)
  notes     String?
  createdAt DateTime @default(now())

  company   Company @relation(fields: [companyId], references: [id])
  companyId String

  customer   Customer @relation(fields: [customerId], references: [id])
  customerId String

  professional   Professional @relation(fields: [professionalId], references: [id])
  professionalId String

  service   Service @relation(fields: [serviceId], references: [id])
  serviceId String
}